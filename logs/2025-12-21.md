# Session Notes - 21 December 2025

## Achievements Today

### DNA Match Import System
- Created `ancestry_import.py` script to pull DNA matches from Ancestry.com API
- Set up Python venv with `browser_cookie3` and `requests` dependencies
- Successfully authenticated using browser cookies extracted from Chrome

### Database Progress
- **523 DNA matches** now in `dna_match` table
- Imported 200 matches via API (more precise cM values)
- Imported ~320 matches manually from text files (matches1.txt - matches13.txt)
- Cleaned up duplicates after API import

### Key Matches Identified
| Match | cM | Side | Notes |
|-------|-----|------|-------|
| Rebecca Hyndman | 2699 | both | Sister |
| Bruce Horrocks | 605 | both | 1st cousin |
| Toby Yates | 466 | both | Close family - investigate |
| geri_wood | 49 | paternal | Wood line |
| Kim Parker | 44 | paternal | Parker line |
| Rachel Wrathall | 38 | unknown | Wrathall/Lowther connection |
| Jed Wood | 33 | paternal | Wood line |
| John Parker | 19 | maternal | Connects to Jane Parker (b.1768) research |

### Parker Line Research (via sdframe)
- sdframe (21 cM, maternal) has 123,772 person tree
- Found Jane Parker (b.1768) in sdframe's tree
- Jane Parker married Robert Weir â†’ Margaret Weir â†’ Elizabeth Hogg â†’ Thomas Muir line
- Common ancestor likely Jane Parker's PARENTS (~1740s)
- 16 shared match links stored in `dna_shared_match_group` table

---

## Technical Learnings

### Ancestry API
- **Base URL:** `https://www.ancestry.co.uk` (not .com for UK accounts)
- **Cookie domain:** `.ancestry.co.uk`
- **Test GUID discovery:** Navigate to `/dna` and extract GUID from redirect URL
  - Example: `/dna/insights/E756DE6C-0C8D-443B-8793-ADDB6F35FD6A`
- **Chris's Test GUID:** `E756DE6C-0C8D-443B-8793-ADDB6F35FD6A`

### API Limitations Discovered
- Returns max **200 matches per request**
- Pagination parameters (`page`, `pagesize`, `offset`) are **ignored**
- Filter parameters (`mincm`, `maxcm`, `filter`) are **ignored**
- API returns same 200 matches regardless of parameters
- Likely requires cursor-based pagination or different endpoint for more matches

### API Response Structure
```json
{
  "matchCount": 200,
  "matchGroups": [
    {
      "name": {"key": "IMMEDIATE_FAMILY", "id": 2},
      "matches": [
        {
          "displayName": "Name",
          "testGuid": "GUID",
          "relationship": {
            "sharedCentimorgans": 123.456,
            "sharedSegments": 5
          },
          "maternal": true/false,
          "paternal": true/false,
          "relationshipLabel": "1st cousin"
        }
      ]
    }
  ]
}
```

### Cookie Extraction
- Browser must be **CLOSED** for cookies to be readable on macOS
- `browser_cookie3.chrome(domain_name=".ancestry.co.uk")` works well
- Returns ~55 cookies for authenticated session

---

## Database Schema Reminder

```sql
-- Main DNA match table
dna_match (
  id, ancestry_id, name, shared_cm, shared_segments,
  predicted_relationship, common_ancestor_id, match_side,
  has_tree, tree_size, notes, cluster_group, confirmed, created_at
)

-- Link matches to known ancestors
dna_match_ancestor_link (
  id, dna_match_id, person_id, relationship_to_match, confidence, notes
)

-- Track shared matches for triangulation
dna_shared_match_group (
  id, match1_id, match2_id, shared_cm, notes
)
```

---

## TODO for Next Session

### High Priority
1. **Get remaining matches** - Try browser automation (Playwright/Selenium) or continue manual text file imports
2. **Investigate Toby Yates** (466 cM) - Very close match, should be easy to identify
3. **Research Bruce Horrocks** (605 cM) - 1st cousin, connect to known family

### Medium Priority
4. **Build out Wood connections** - geri_wood, Jed Wood, Ryan Wood, Travis Wood all paternal
5. **Investigate Parker lines** - Kim Parker (paternal) vs John Parker (maternal)
6. **Follow up Jane Parker (b.1768)** - Find her parents to identify common ancestor with sdframe

### Low Priority
7. **Add tree_size data** - API didn't return tree info, may need separate endpoint
8. **Cluster analysis** - Group matches by shared matches to identify family branches
9. **Link matches to person table** - Connect confirmed matches to known ancestors

---

## Files Reference
- `ancestry_import.py` - Main import script
- `genealogy.db` - SQLite database (85 people, 523 DNA matches)
- `matches1.txt` - `matches13.txt` - Raw match data from Ancestry UI
- `venv/` - Python virtual environment
- `migrations/004_dna_matches.sql` - DNA table schema

---

## Amusing Note
A "ghost" apparently typed "yes write the script" during the session. The user suspects an ancestral spirit is eager to be found. The Parker ghost from the 1740s perhaps? ðŸ‘»
