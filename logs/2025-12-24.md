# Session Notes - 24 December 2025

## Status (End of day ~23:15)

**OVERNIGHT RUN STARTED** - PID 81900
Log: `/Users/chris/dev-familytree/overnight_log.txt`

### Overnight tasks:
1. Import 15 remaining DNA match trees (max 2000 people each)
2. Discover tree IDs for 50 more matches (>= 15 cM)
3. Import those newly discovered trees
4. Fetch shared matches for matches >= 20 cM

**Database at end of session**:
- 12,577 people
- 12,353 relationships
- 17 trees imported
- 4,984 shared match records

### Latest Surname Counts:
| Surname | Count |
|---------|-------|
| Virgo | 236 |
| Wood | 220 |
| Copland | 57 |
| Worthington | 56 |
| Lightfoot | 48 |
| Wrathall | 47 |
| Tart | 30 |
| Heywood | 27 |
| Lonsdale | 9 |
| Lowther | 5 |

### Key discoveries today:
- **Daisy Morphet** connection traced: Thomas Morphet of Rash, Dent, Yorkshire → Jane Morphet → Mary Alice Metcalfe → Henry Lonsdale Wrathall → you
- **Virgos exploded** (14 → 236) - major family connection
- **"Lonsdale" as middle name** in Wrathall & Worthington lines
- **Rachel Wrathall** is a DNA match (38.1 cM)

### Key Finding from Rebecca Hyndman's tree (your sister):
- **Henry Lonsdale Wrathall** - your 2nd great-grandfather
- **Constance Mary Lonsdale Wrathall**
- **Arthur Gordon Lonsdale Worthington**
- "Lonsdale" appears as a middle name in both Wrathall and Worthington lines!

---

## Summary
Built tree relationship import system to capture family structure from Ancestry trees.

## Problem Solved
Previously imported 505k people from trees but had **zero relationship data** - no parent/child/spouse connections. Without relationships, couldn't trace how Lowthers and Wrathalls are connected.

## Solution
Discovered that Ancestry person pages contain embedded JSON with family links:
- `"Father":{"Id":123,"FullName":"Name"...}`
- `"Mother":{"Id":456,"FullName":"Name"...}`
- `"SpouseList":[{"Id":789,"FullName":"Name"...}]`

Created scripts to extract this data.

## New Scripts

### 1. `import_ancestry_tree.py` - Main Import Script
Imports a complete Ancestry tree with people AND relationships.

```bash
# Import a tree (with rate limiting)
python import_ancestry_tree.py TREE_ID --delay 0.3

# Limit to first N persons
python import_ancestry_tree.py TREE_ID --limit 100

# Show stats only
python import_ancestry_tree.py TREE_ID --stats

# Re-import existing (force)
python import_ancestry_tree.py TREE_ID --force
```

### 2. `import_tree_relationships.py` - Relationship-Only Import
Imports just relationships for persons already in the database.

```bash
python import_tree_relationships.py TREE_ID --delay 0.3
```

### 3. `explore_tree_api.py` - API Exploration
Used to discover the Ancestry API structure. Helpful for debugging.

### 4. `ancestry_import.py` - DNA Match Import
Original script for importing DNA matches (from Dec 21-22).

## Database Schema Updates

### New column on `person` table:
```sql
ancestry_person_id TEXT  -- Links to Ancestry's person ID
```

### New table `tree_relationship`:
```sql
CREATE TABLE tree_relationship (
    id INTEGER PRIMARY KEY,
    tree_id INTEGER NOT NULL,        -- Ancestry tree ID
    ancestry_person_id TEXT NOT NULL, -- Person's Ancestry ID
    father_id TEXT,                   -- Father's Ancestry ID
    mother_id TEXT,                   -- Mother's Ancestry ID
    spouse_ids TEXT,                  -- JSON array of spouse IDs
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(tree_id, ancestry_person_id)
);
```

## Current Import Status
Tree 18571258 (Lowther/Wrathall tree) - importing ~4,400+ persons with relationships.

## Key Findings from Dec 23
Tree 18571258 contains BOTH:
- **Noble Lowthers**: Sir Richard Lowther (High Sheriff of Cumberland), Sir Christopher Lowther, etc.
- **Wrathalls**: Antonie Wraythall, John Wrathall (b. 1683), Thomas (b. 1729), etc.

Owner (Vicki Steele) is NOT a DNA match, so this is someone else's research, not direct evidence of YOUR Lowther connection. But it documents a historical connection between the families.

## Next Steps
1. Complete tree 18571258 import
2. Query to find the path between any Lowther and any Wrathall
3. Import other trees of interest
4. Cross-reference with DNA matches

## Useful Queries

### Find path between two people (via parents)
```sql
-- Get all ancestors of a person
WITH RECURSIVE ancestors AS (
    SELECT ancestry_person_id, father_id, mother_id, 0 as generation
    FROM tree_relationship
    WHERE ancestry_person_id = 'START_ID'

    UNION ALL

    SELECT tr.ancestry_person_id, tr.father_id, tr.mother_id, a.generation + 1
    FROM tree_relationship tr
    JOIN ancestors a ON tr.ancestry_person_id = a.father_id
                     OR tr.ancestry_person_id = a.mother_id
    WHERE a.generation < 20
)
SELECT * FROM ancestors;
```

### Find all Lowthers in a tree
```sql
SELECT p.name, p.ancestry_person_id, p.birth_year_estimate
FROM person p
WHERE p.tree_id = 109  -- local tree ID for 18571258
AND p.name LIKE '%Lowther%';
```

### Find all Wrathalls in a tree
```sql
SELECT p.name, p.ancestry_person_id, p.birth_year_estimate
FROM person p
WHERE p.tree_id = 109
AND p.name LIKE '%Wrathall%' OR p.name LIKE '%Wraythall%';
```
